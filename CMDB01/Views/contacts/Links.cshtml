@model IEnumerable<CMDB01.Models.ContactLinks>

@{
    ViewBag.Title = "Links";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/flipCards.css" rel="stylesheet" />
<link href="~/Content/chosen.min.css" rel="stylesheet" />
<script src="~/Scripts/chosen.jquery.min.js"></script>

<h2>Links</h2>


<div class="row">
    <div class="col-md-3">
        <h4>Search...</h4>
        @Html.ListBox("conLinkedOptions", ViewBag.conLinkedOptions as MultiSelectList, new { @id = "conLinkedOptions", @class = "form-control chosen-select4", style = "width:300px;" })

        <a class="btn btn-warning glyphicon glyphicon-filter" id="btnFilter"></a>
        <a class="btn btn-danger glyphicon glyphicon-refresh" id="btnReset"></a>
        <a class="btn btn-primary glyphicon glyphicon-envelope" id="btnEmail" style="width:70px"></a>

        <hr />

        @*Hidden Fields*@
        <input type="hidden" name="Options" id="Options" />
        @*<input type="hidden" name="OptionsIds" id="OptionsIds" />*@


        @* Render Filter box before Showing the Cards *@
        <script> $('#conLinkedOptions').chosen(); </script>
        @*<script> $('#multiSearch').chosen(); </script>*@
        @* ------------------------------------------ *@

        <h5>Account</h5>
        @foreach (var item in Model)
        {
            if (Model.Count() > 0)
            {
                

                if (item.entityType.ToLower() == "account")
                {
                <span class="badge badge-success">@item.account.Name</span>
                }
                if (item.entityType.ToLower() == "server farm")
                {
                <span class="badge badge-success">@item.server.account.Name</span>
                }
                if (item.entityType.ToLower() == "datasource")
                {
                <span class="badge badge-success">@item.datasource.ServerFarm.account.Name</span>
                }
            }
        }
        <hr />
        <h5>Data Center</h5>
        <hr />
        <h5>Server Farm</h5>
        <hr />
        <h5>Datasource</h5>
        @foreach (var ds in Model.Where(a => a.entityType.ToLower() == "datasource").OrderBy(r => r.datasource.Name).Select(a => a.datasource.Name).Distinct())
        {
            if (!string.IsNullOrEmpty(ds))
            {
                <span class="badge badge-success">@ds</span>
            }
            else
            {
                <span class="badge badge-success">null</span>
            }

        }
        <hr />
        <h5>Category</h5>
        <hr />
    </div>
</div>
<script>
    $("#btnSearch").click(function () {
        window.location = "/contacts/index?SearchValue=" + $("#SearchValue").val()
            + "&accountLst=" + $("#accountLst").val()
            + "&datacenterLst=" + $("#datacenterLst").val()
            + "&datasourceLst=" + $("#datasourceLst").val()
            + "&serverfarmLst=" + $("#serverfarmLst").val();
    });


    $("#btnReset").click(function () {
        window.location = "/contacts/index";
    });

    function rotateCard(btn) {
        var $card = $(btn).closest('.card-container');
        console.log($card);
        if ($card.hasClass('hover')) {
            $card.removeClass('hover');
        } else {
            $card.addClass('hover');
        }
    };

    $('#btnFilter').on("click", function (event, params) {
        var selectedDimensionValues = [];
        //push the selected Values to the Hidden iput tags - Softwares
        $("#conLinkedOptions :selected").each(function () {
            selectedDimensionValues.push($(this).text());
        });

        //$("#OptionsIds").val(selectedDimensionValues);

        window.location = "/contacts/Links?Options=" + selectedDimensionValues;
    });
</script>